<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<h1>Music</h1>
<!-- https://codepen.io/craigstroman/pen/aOyRYx -->

<audio id="audioPlayer" preload="none" controls="controls" tabindex="0">
    <source src="music.mp3" data-track-number="1" />
    <source src="https://archive.org/download/calexico2006-12-02..flac16/calexico2006-12-02d1t02.mp3" data-track-number="2" />
</audio>

<span id="currentTime">0</span>

<button id="takeControl">Take Control</button> | <button id="giveControl">Give up control</button>

<script>
	let audioPlayer = document.getElementById('audioPlayer');
	let currentTimeText = document.getElementById('currentTime');
	let songData = {
        currentTime: 0
	};
	let socket = io();
	socket.emit('song change', 'test');
	socket.on('notify song change', function(msg) {
        console.log("Song change notification");
	});
	// working switch
	// setTimeout(() => {
    //     audioPlayer.setAttribute('src', 'https://archive.org/download/calexico2006-12-02..flac16/calexico2006-12-02d1t02.mp3');
    //     audioPlayer.play();
	// }, 10000);

    audioPlayer.onplay = () => {
	    console.log("play");
		audioPlayer.currentTime = 0;
    };
	// Send time updates to listeners
	audioPlayer.ontimeupdate = () => {
		currentTimeText.innerText = audioPlayer.currentTime;
		songData.currentTime = audioPlayer.currentTime;
		socket.send(JSON.stringify(songData));
    };
</script>
</body>
</html>